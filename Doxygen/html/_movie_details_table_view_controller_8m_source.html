<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>Movie Reviews: Movie Reviews/Controllers/MovieDetailsTableViewController.m Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Movie Reviews
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_movie_details_table_view_controller_8m_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">MovieDetailsTableViewController.m</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//  MovieDetailsTableViewController.m</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">//  Movie Reviews</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">//  Created by Christos C on 09/08/2015.</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">//  Copyright (c) 2015 testCompany Development. All rights reserved.</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#import &quot;MovieDetailsTableViewController.h&quot;</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#import &quot;DataModels.h&quot;</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#import &quot;UITableViewCell+APICell.h&quot;</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#import &quot;AlertUser.h&quot;</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#import &lt;KINWebBrowser/KINWebBrowserViewController.h&gt;</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#import &lt;AFNetworking.h&gt;</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#import &quot;UIDevice+Additions.h&quot;</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="keyword">typedef</span> NS_ENUM(NSUInteger, cellType){</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    cellTypeHeader,</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    cellTypeReview,</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    cellTypeDetails,</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;};</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="keyword">typedef</span> NS_ENUM(NSUInteger, cellTypeCount){</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    cellTypeCountAll = 3,</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    cellTypeCountNoReview = 2,</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;};</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="keyword">typedef</span> NS_ENUM(NSUInteger, sectionType){</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    sectionTypeMovieInfo,</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    sectionTypeMovieLinks,</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;};</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div>
<div class="line"><a name="l00063"></a><span class="lineno"><a class="line" href="category_movie_details_table_view_controller_07_08.html">   63</a></span>&#160;<span class="keyword">@interface </span><a class="code" href="interface_movie_details_table_view_controller.html">MovieDetailsTableViewController</a> ()&lt;KINWebBrowserDelegate&gt;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="keyword">@property</span> (nonatomic,readonly,getter=isCapsuleReviewAvailable) BOOL capsuleReviewAvailable;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="keyword">@property</span> (nonatomic,readonly,getter=isMovieInFavourites) BOOL movieInFavourites;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="keyword">@property</span> (nonatomic,assign) BOOL <span class="keyword">const</span> initialCheckIsMovieInFavourites;<span class="comment">//we need this besides the above to store the value of above property so that this can be used by the saveContext method to determine what was supposed to happen - was it supposed to add or remove, this affects the message it displays. this gets assigned before the save context method fires because if we call the movieInFavourites instead the answer we will get wont be relevant</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="keyword">@property</span> (nonatomic,strong)<a class="code" href="interface_results.html">Results</a> *itemToSave;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="keyword">@property</span> (weak, nonatomic) IBOutlet UIBarButtonItem *barButtonAddRemove;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="preprocessor">#warning iOS7 autoheight 1/4</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">// The cells below will be used on iOS7 to calculate the cell height for each custom cell type</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="keyword">@property</span> (strong, nonatomic) UITableViewCell *heightCellHeader;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="keyword">@property</span> (strong, nonatomic) UITableViewCell *heightCellReviews;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="keyword">@property</span> (strong, nonatomic) UITableViewCell *heightCellDetails;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="keyword">@end</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="keyword">@implementation </span><a class="code" href="interface_movie_details_table_view_controller.html">MovieDetailsTableViewController</a></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;- (void)viewDidLoad {</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    [<span class="keyword">super</span> viewDidLoad];</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    [<span class="keyword">self</span> setupTableViewCellType];</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    [<span class="keyword">self</span> setupInterface];</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <span class="comment">// Uncomment the following line to preserve selection between presentations.</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <span class="comment">// self.clearsSelectionOnViewWillAppear = NO;</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    </div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <span class="comment">// Uncomment the following line to display an Edit button in the navigation bar for this view controller.</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="comment">// self.navigationItem.rightBarButtonItem = self.editButtonItem;</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;}</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;- (void)viewWillAppear:(BOOL)animated</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;{</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    [<span class="keyword">super</span> viewWillAppear:animated];</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="comment">//we do this in willAppear so that if the favourite is removed via the favourites screen then this button will change accordingly</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    [<span class="keyword">self</span> setupBarButton];</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;}</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;- (void)didReceiveMemoryWarning {</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    [<span class="keyword">super</span> didReceiveMemoryWarning];</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="comment">// Dispose of any resources that can be recreated.</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;}</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="preprocessor">#pragma mark - Table view data source</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;- (NSInteger)numberOfSectionsInTableView:(UITableView *)tableView {</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="keywordflow">return</span> 2;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;}</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;- (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section {</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <span class="comment">// Return the number of rows in the section.</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    NSInteger rowCount = 0;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <span class="keywordflow">switch</span> (section)</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    {</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        <span class="keywordflow">case</span> sectionTypeMovieInfo:</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        {</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;            rowCount = cellTypeCountAll;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;            <span class="keywordflow">if</span> (!<span class="keyword">self</span>.isCapsuleReviewAvailable)</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;            {</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;                rowCount = cellTypeCountNoReview;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;            }</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;            </div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        }</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        <span class="keywordflow">case</span> sectionTypeMovieLinks:</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        {</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;            <span class="keywordflow">if</span> (<span class="keyword">self</span>.<a class="code" href="interface_movie_details_table_view_controller.html#a2d7f8d8a99899a814ea8f6938c35186c">offlineSelection</a>)</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;            {</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;                rowCount = <span class="keyword">self</span>.<a class="code" href="interface_movie_details_table_view_controller.html#a2d7f8d8a99899a814ea8f6938c35186c">offlineSelection</a>.relatedUrls.count;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;            }</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;            {</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;                rowCount = <span class="keyword">self</span>.onlineSelection.relatedUrls.count;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;            }</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        }</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;            </div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    }</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="keywordflow">return</span> rowCount;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;}</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="preprocessor">#pragma mark - UITableViewController Delegate Methods</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath {</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    UITableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:[<span class="keyword">self</span> getMovieCellReuseIdentifierForRowAtIndexPath:indexPath] forIndexPath:indexPath];</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    </div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <span class="keywordflow">if</span> (indexPath.section == sectionTypeMovieInfo)</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    {</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">self</span>.<a class="code" href="interface_movie_details_table_view_controller.html#a2d7f8d8a99899a814ea8f6938c35186c">offlineSelection</a>)</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        {</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;            [cell configureWithFavourite:self.offlineSelection];</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        }</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        {</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;            [cell configureWithResult:self.onlineSelection];</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;            </div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        }</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    }</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    {</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">self</span>.<a class="code" href="interface_movie_details_table_view_controller.html#a2d7f8d8a99899a814ea8f6938c35186c">offlineSelection</a>)</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        {</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;            [<span class="keyword">self</span> configureOverviewSectionWithFavourite:self.offlineSelection forCell:cell atIndexPath:indexPath];</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        }</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        {</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;            [<span class="keyword">self</span> configureOverviewSectionWithResult:self.onlineSelection forCell:cell atIndexPath:indexPath];</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;            </div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        }</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        </div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    }</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    </div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <span class="comment">// Configure the cell...</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    </div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="keywordflow">return</span> cell;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;}</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;- (void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;{</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    </div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="keywordflow">if</span> (indexPath.section == sectionTypeMovieLinks)</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    {</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        NSString *urlToLoad;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        </div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">self</span>.<a class="code" href="interface_movie_details_table_view_controller.html#a2d7f8d8a99899a814ea8f6938c35186c">offlineSelection</a>)</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        {</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;            urlToLoad = ((<a class="code" href="interface_related_urls.html">RelatedUrls</a> *)<span class="keyword">self</span>.<a class="code" href="interface_movie_details_table_view_controller.html#a2d7f8d8a99899a814ea8f6938c35186c">offlineSelection</a>.relatedUrls.allObjects[indexPath.row]).url;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        }</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        {</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;            urlToLoad = ((<a class="code" href="interface_n_y_t_related_urls.html">NYTRelatedUrls</a> *)<span class="keyword">self</span>.<a class="code" href="interface_movie_details_table_view_controller.html#a7a3ecf4ac3c7785033f15ee77f1ec351">onlineSelection</a>.relatedUrls[indexPath.row]).url;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        }</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        </div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        [<span class="keyword">self</span> performOpenMovieLink:urlToLoad];</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    }</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;}</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;- (void)tableView:(UITableView *)tableView willDisplayCell:(UITableViewCell *)cell forRowAtIndexPath:(NSIndexPath *)indexPath</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;{</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    [cell animateCellScrolling];</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;}</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;- (CGFloat)tableView:(UITableView *)tableView estimatedHeightForRowAtIndexPath:(NSIndexPath *)indexPath</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;{</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="keywordflow">return</span> 100.0f;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;}</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;-(CGFloat)tableView:(UITableView *)tableView heightForRowAtIndexPath:(NSIndexPath *)indexPath</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;{</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="keywordflow">if</span> ([UIDevice majorSystemVersion] &gt;= 8)</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    {</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        <span class="keywordflow">return</span> UITableViewAutomaticDimension;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    }</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (indexPath.section == sectionTypeMovieInfo)</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    {</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="preprocessor">#warning iOS7 autoheight 3/3</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        CGFloat cellHeight = [<span class="keyword">self</span> tableViewCellHeightForiOS7:tableView calculateHeightForIndexPath:indexPath];</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        <span class="keywordflow">return</span> cellHeight;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    }</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <span class="keywordflow">else</span> <span class="comment">// overview cells which use the default cells so we cant calculate it automatically like the rest of the cell types</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    {</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        <span class="keywordflow">return</span> 60.0f;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    }</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;}</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;- (CGFloat)tableViewCellHeightForiOS7:(UITableView *)tableView calculateHeightForIndexPath:(NSIndexPath *)indexPath</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;{</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    CGFloat cellHeight = 100;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    UITableViewCell *heightCell;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <span class="keywordflow">switch</span> (indexPath.row)</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    {</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        <span class="keywordflow">case</span> cellTypeHeader:</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        {</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;            heightCell = <span class="keyword">self</span>.heightCellHeader;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        }</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;            </div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        <span class="keywordflow">case</span> cellTypeReview:</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;        {</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;            heightCell = <span class="keyword">self</span>.heightCellReviews;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;            <span class="keywordflow">if</span> (<span class="keyword">self</span>.isCapsuleReviewAvailable) <span class="comment">// if there isnt a capsule review then we dont break so that the cell will get configured as self.heightCellDetails from below</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;            {</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;            }</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        }</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;            </div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        <span class="keywordflow">case</span> cellTypeDetails:</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        {</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;            heightCell = <span class="keyword">self</span>.heightCellDetails;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        }</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;        <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    }</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">self</span>.<a class="code" href="interface_movie_details_table_view_controller.html#a7a3ecf4ac3c7785033f15ee77f1ec351">onlineSelection</a>)</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    {</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        [heightCell configureWithResult:self.onlineSelection];</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    }</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    {</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        [heightCell configureWithFavourite:self.offlineSelection];</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        </div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    }</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="preprocessor">#warning iOS7 autoheight 4/4</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    cellHeight = [heightCell returnCellAutoHeight];</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    <span class="comment">// Add an extra point to the height to account for the cell separator, which is added between the bottom</span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    <span class="comment">// of the cell&#39;s contentView and the bottom of the table view cell.</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    cellHeight += 1;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    </div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <span class="keywordflow">return</span> cellHeight;</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;}</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="preprocessor">#pragma mark - UITableViewController Delegate Helper Methods</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;-(void)configureOverviewSectionWithResult:(<a class="code" href="interface_n_y_t_results.html">NYTResults</a> *)result forCell:(UITableViewCell *)cell atIndexPath:(NSIndexPath *)indexPath</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;{</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    cell.textLabel.text = ((<a class="code" href="interface_n_y_t_related_urls.html">NYTRelatedUrls</a> *)result.relatedUrls[indexPath.row]).suggestedLinkText;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;}</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;-(void)configureOverviewSectionWithFavourite:(<a class="code" href="interface_results.html">Results</a> *)result forCell:(UITableViewCell *)cell atIndexPath:(NSIndexPath *)indexPath</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;{</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    cell.textLabel.text = ((<a class="code" href="interface_related_urls.html">RelatedUrls</a> *)result.relatedUrls.allObjects[indexPath.row]).suggestedLinkText;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;}</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;-(BOOL)isCapsuleReviewAvailable</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;{</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    NSString *capsuleReview;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    BOOL isAvailable = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">self</span>.<a class="code" href="interface_movie_details_table_view_controller.html#a2d7f8d8a99899a814ea8f6938c35186c">offlineSelection</a>)</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    {</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;        capsuleReview = <span class="keyword">self</span>.offlineSelection.capsuleReview;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    }</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    {</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        capsuleReview = <span class="keyword">self</span>.onlineSelection.capsuleReview;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    }</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    </div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    <span class="keywordflow">if</span> (capsuleReview &amp;&amp; capsuleReview.length &gt; 0 )</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    {</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;        isAvailable = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    }</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    <span class="keywordflow">return</span> isAvailable;</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;}</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;-(NSString *)getMovieCellReuseIdentifierForRowAtIndexPath:(NSIndexPath *)indexPath</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;{</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    NSString *reuseIdentifier = CellIdentifierNormal;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <span class="keywordflow">if</span> (indexPath.section == 0)</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    {</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;        <span class="keywordflow">switch</span> (indexPath.row)</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        {</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;            <span class="keywordflow">case</span> 0:</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;            {</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                reuseIdentifier = CellIdentifierMovieDetailsHeader;</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;            }</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;            <span class="keywordflow">case</span> 1:</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;            {</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;                <span class="keywordflow">if</span> (<span class="keyword">self</span>.isCapsuleReviewAvailable)</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;                {</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;                    reuseIdentifier = CellIdentifierMovieDetailsReview;</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;                }</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;                <span class="comment">// if there isnt a capsuleReview available then we dont break here so that the reuseIdentifier for the second cell will be that of the CellIdentifierMovieDetailsDescription</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;                </div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;            }</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;            <span class="keywordflow">case</span> 2:</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;            {</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;                reuseIdentifier = CellIdentifierMovieDetailsDescription;</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;            }</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;            <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;        }</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    }</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    {</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        reuseIdentifier = CellIdentifierMovieDetailsOverview;</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    }</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <span class="keywordflow">return</span> reuseIdentifier;</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;}</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="preprocessor">#pragma mark - Setup Methods</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;-(void)setupInterface</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;{</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <span class="keyword">self</span>.tableView.tableFooterView = [UIView new];<span class="comment">// trick to remove the empty cells at the bottom of the view</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    <span class="keyword">self</span>.initialCheckIsMovieInFavourites = <span class="keyword">self</span>.isMovieInFavourites;</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <span class="keyword">self</span>.title = <span class="stringliteral">@&quot;Movie Details&quot;</span>;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    <span class="keyword">self</span>.tableView.estimatedRowHeight = 100.0f;</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    <span class="keyword">self</span>.tableView.rowHeight = UITableViewAutomaticDimension;</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;}</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;- (void)setupTableViewCellType</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;{</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    <span class="comment">// register the custom tableview cells we want to use</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    [<span class="keyword">self</span>.tableView registerNib:[UINib nibWithNibName:CellIdentifierMovieDetailsHeader bundle:[NSBundle mainBundle]]  forCellReuseIdentifier:CellIdentifierMovieDetailsHeader];</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    [<span class="keyword">self</span>.tableView registerNib:[UINib nibWithNibName:CellIdentifierMovieDetailsReview bundle:[NSBundle mainBundle]]  forCellReuseIdentifier:CellIdentifierMovieDetailsReview];</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    [<span class="keyword">self</span>.tableView registerNib:[UINib nibWithNibName:CellIdentifierMovieDetailsDescription bundle:[NSBundle mainBundle]]  forCellReuseIdentifier:CellIdentifierMovieDetailsDescription];</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    </div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<span class="preprocessor">#warning iOS7 autoheight 2/4</span></div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <span class="keywordflow">if</span> ([UIDevice majorSystemVersion] &lt; 8 )</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    {</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;        <span class="keyword">self</span>.heightCellHeader  = [<span class="keyword">self</span>.tableView dequeueReusableCellWithIdentifier:CellIdentifierMovieDetailsHeader];</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        <span class="keyword">self</span>.heightCellReviews  = [<span class="keyword">self</span>.tableView dequeueReusableCellWithIdentifier:CellIdentifierMovieDetailsReview];</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;        <span class="keyword">self</span>.heightCellDetails  = [<span class="keyword">self</span>.tableView dequeueReusableCellWithIdentifier:CellIdentifierMovieDetailsDescription];</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    }</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;}</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;-(void)setupBarButton</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;{</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">self</span>.<a class="code" href="interface_movie_details_table_view_controller.html#a2d7f8d8a99899a814ea8f6938c35186c">offlineSelection</a>)</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    {</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        <span class="keyword">self</span>.barButtonAddRemove.title = <span class="stringliteral">@&quot;Remove Favourite&quot;</span>;</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    }</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    {</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">self</span>.isMovieInFavourites)</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        {</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;            <span class="keyword">self</span>.barButtonAddRemove.title = <span class="stringliteral">@&quot;Remove Favourite&quot;</span>;</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;        }</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;        {</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;            <span class="keyword">self</span>.barButtonAddRemove.title = <span class="stringliteral">@&quot;Add Favourite&quot;</span>;</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;        }</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    }</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    </div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;}</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;-(BOOL)isMovieInFavourites</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;{</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    BOOL isInFavourites = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    NSArray *favouriteMoviesIDs = [[<a class="code" href="interface_results.html">Results</a> MR_findAll] valueForKey:@&quot;nytMovieId&quot;];</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    <span class="comment">//if array is empty we wont try and compare since that tells us that they dont have any favourites and if we try to compare using containsObject on a nil array - when no favourites are there - we will get a crash</span></div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    <span class="keywordflow">if</span> (favouriteMoviesIDs &amp;&amp; favouriteMoviesIDs.count &gt; 0)</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    {</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;        <span class="comment">//check if any of the previously saved model objects has the same movieId, in that case it means we already saved it</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">self</span>.<a class="code" href="interface_movie_details_table_view_controller.html#a7a3ecf4ac3c7785033f15ee77f1ec351">onlineSelection</a>)</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;        {</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;            isInFavourites = [favouriteMoviesIDs containsObject:self.onlineSelection.nytMovieId];</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;        }</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;        {</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;            isInFavourites = [favouriteMoviesIDs containsObject:self.offlineSelection.nytMovieId];</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        }</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    }</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    <span class="keywordflow">return</span> isInFavourites;</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;}</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;<span class="preprocessor">#pragma mark - IBActions</span></div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;- (IBAction)performAddRemoveFavourite:(<span class="keywordtype">id</span>)sender</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;{</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    <span class="keyword">self</span>.initialCheckIsMovieInFavourites = <span class="keyword">self</span>.isMovieInFavourites;</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">self</span>.<a class="code" href="interface_movie_details_table_view_controller.html#a7a3ecf4ac3c7785033f15ee77f1ec351">onlineSelection</a>) {</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;        </div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;        <span class="comment">//check if the selected movie already exists in our favourites, if not then a model object is created to be saved</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;        <span class="keywordflow">if</span> (!<span class="keyword">self</span>.initialCheckIsMovieInFavourites)</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;        {</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;            <span class="comment">//create the entity from the NYT model so that it gets added to the current context and its saved when the context is saved</span></div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;            <span class="keyword">self</span>.itemToSave = [<a class="code" href="interface_interact_with_model.html">InteractWithModel</a> <a class="code" href="interface_interact_with_model.html#abdb7dd4432c563fa4e8123f774711570">initResultFromModel</a>:self.onlineSelection];</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;        }</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;        {</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;            <span class="keyword">self</span>.itemToSave = [<a class="code" href="interface_results.html">Results</a> MR_findFirstByAttribute:@&quot;nytMovieId&quot; withValue:self.onlineSelection.nytMovieId];</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;            NSLog(<span class="stringliteral">@&quot;existing result: %@ opened result: %@&quot;</span>,<span class="keyword">self</span>.itemToSave.nytMovieId, <span class="keyword">self</span>.onlineSelection.nytMovieId);</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;            [<span class="keyword">self</span>.itemToSave MR_deleteEntity];</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;            </div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;        }</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    }</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    {</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;        <span class="comment">//delete the entity from the current context</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;        [<span class="keyword">self</span>.offlineSelection MR_deleteEntity];</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;        <span class="keyword">self</span>.navigationItem.rightBarButtonItem = nil;</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    }</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    [<span class="keyword">self</span> saveContext];</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    </div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;}</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;- (void)performOpenMovieLink:(NSString *)link</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;{</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    <span class="keywordflow">if</span> ([[AFNetworkReachabilityManager sharedManager] isReachable]) <span class="comment">// has internet connection?</span></div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    {</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;        KINWebBrowserViewController *webBrowser = [KINWebBrowserViewController webBrowser];</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;        webBrowser.barTintColor = <span class="keyword">self</span>.navigationController.navigationBar.barTintColor;</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        webBrowser.tintColor = <span class="keyword">self</span>.navigationController.navigationBar.tintColor;</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;        [webBrowser setDelegate:self];</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;        webBrowser.hidesBottomBarWhenPushed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;        [webBrowser loadURLString:link];</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;        [<span class="keyword">self</span>.navigationController pushViewController:webBrowser animated:YES];</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        </div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    }</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    {</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;        [<a class="code" href="interface_alert_user.html">AlertUser</a> showError:@&quot;No Internet Connection Available&quot; customTitle:@&quot;Can&#39;t Open Website&quot;];</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    }</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;}</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;- (void)saveContext</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;{</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    [[NSManagedObjectContext MR_defaultContext] MR_saveToPersistentStoreWithCompletion:^(BOOL success, NSError *error) {</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;        NSString *alertMsg;</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;        if (success) {</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;            NSLog(@&quot;You successfully saved your context.&quot;);</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;            if (!self.initialCheckIsMovieInFavourites)</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;            {</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;                alertMsg = @&quot;Successfully added to favourites&quot;;</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;                self.barButtonAddRemove.title = @&quot;Remove Favourite&quot;;</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;            }</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;            else</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;            {</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;                alertMsg = @&quot;Successfully removed from favourites&quot;;</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;                self.barButtonAddRemove.title = @&quot;Add Favourite&quot;;</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;            }</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;            [<a class="code" href="interface_alert_user.html">AlertUser</a> showSuccess:alertMsg customTitleMessage:nil];</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;        }</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;        else if (error)</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;        {</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;            if (!self.initialCheckIsMovieInFavourites)</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;            {</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;                alertMsg = @&quot;Error Adding To Favourites&quot;;</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;            }</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;            else</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;            {</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;                alertMsg = @&quot;Error Removing From Favourites&quot;;</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;            }</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;            </div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;            [<a class="code" href="interface_alert_user.html">AlertUser</a> showError:error.description customTitle:alertMsg];</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;            NSLog(@&quot;Error saving context: %@&quot;, error.description);</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;        }</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    }];</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;}</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;<span class="keyword">@end</span></div>
<div class="ttc" id="interface_movie_details_table_view_controller_html"><div class="ttname"><a href="interface_movie_details_table_view_controller.html">MovieDetailsTableViewController</a></div><div class="ttdef"><b>Definition:</b> <a href="_movie_details_table_view_controller_8h_source.html#l00014">MovieDetailsTableViewController.h:14</a></div></div>
<div class="ttc" id="interface_alert_user_html"><div class="ttname"><a href="interface_alert_user.html">AlertUser</a></div><div class="ttdef"><b>Definition:</b> <a href="_alert_user_8h_source.html#l00016">AlertUser.h:16</a></div></div>
<div class="ttc" id="interface_interact_with_model_html_abdb7dd4432c563fa4e8123f774711570"><div class="ttname"><a href="interface_interact_with_model.html#abdb7dd4432c563fa4e8123f774711570">+[InteractWithModel initResultFromModel:]</a></div><div class="ttdeci">Results * initResultFromModel:(NYTResults *result)</div><div class="ttdef"><b>Definition:</b> <a href="_interact_with_model_8m_source.html#l00025">InteractWithModel.m:25</a></div></div>
<div class="ttc" id="interface_interact_with_model_html"><div class="ttname"><a href="interface_interact_with_model.html">InteractWithModel</a></div><div class="ttdef"><b>Definition:</b> <a href="_interact_with_model_8h_source.html#l00014">InteractWithModel.h:14</a></div></div>
<div class="ttc" id="interface_results_html"><div class="ttname"><a href="interface_results.html">Results</a></div><div class="ttdef"><b>Definition:</b> <a href="_results_8h_source.html#l00015">Results.h:15</a></div></div>
<div class="ttc" id="interface_n_y_t_results_html"><div class="ttname"><a href="interface_n_y_t_results.html">NYTResults</a></div><div class="ttdef"><b>Definition:</b> <a href="_n_y_t_results_8h_source.html#l00014">NYTResults.h:14</a></div></div>
<div class="ttc" id="interface_n_y_t_related_urls_html"><div class="ttname"><a href="interface_n_y_t_related_urls.html">NYTRelatedUrls</a></div><div class="ttdef"><b>Definition:</b> <a href="_n_y_t_related_urls_8h_source.html#l00011">NYTRelatedUrls.h:11</a></div></div>
<div class="ttc" id="interface_movie_details_table_view_controller_html_a2d7f8d8a99899a814ea8f6938c35186c"><div class="ttname"><a href="interface_movie_details_table_view_controller.html#a2d7f8d8a99899a814ea8f6938c35186c">MovieDetailsTableViewController::offlineSelection</a></div><div class="ttdeci">Results * offlineSelection</div><div class="ttdef"><b>Definition:</b> <a href="_movie_details_table_view_controller_8h_source.html#l00022">MovieDetailsTableViewController.h:22</a></div></div>
<div class="ttc" id="interface_movie_details_table_view_controller_html_a7a3ecf4ac3c7785033f15ee77f1ec351"><div class="ttname"><a href="interface_movie_details_table_view_controller.html#a7a3ecf4ac3c7785033f15ee77f1ec351">MovieDetailsTableViewController::onlineSelection</a></div><div class="ttdeci">NYTResults * onlineSelection</div><div class="ttdef"><b>Definition:</b> <a href="_movie_details_table_view_controller_8h_source.html#l00018">MovieDetailsTableViewController.h:18</a></div></div>
<div class="ttc" id="interface_related_urls_html"><div class="ttname"><a href="interface_related_urls.html">RelatedUrls</a></div><div class="ttdef"><b>Definition:</b> <a href="_related_urls_8h_source.html#l00013">RelatedUrls.h:13</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_577ac98355290653da4acb3a661ea61c.html">Movie Reviews</a></li><li class="navelem"><a class="el" href="dir_388f97d6004f5652b1fe17bc9934b8fb.html">Controllers</a></li><li class="navelem"><b>MovieDetailsTableViewController.m</b></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.10 </li>
  </ul>
</div>
</body>
</html>
